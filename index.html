<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Kelly + LOG</title>
    <style>
        /* mesmo CSS que você já tem, não precisa mudar */
    </style>
</head>
<body>
    <div class="calculator">
        <h1 class="title">Calculadora Kelly + LOG</h1>
        
        <div class="input-group">
            <label class="input-label" for="odd1">Odd Casa 1</label>
            <input type="text" id="odd1" class="input-field" placeholder="Ex: 1.581" />
        </div>

        <div class="input-group">
            <label class="input-label" for="odd2">Odd Casa 2</label>
            <input type="text" id="odd2" class="input-field" placeholder="Ex: 2.20" />
        </div>

        <div class="input-group">
            <label class="input-label" for="oddCasa">Odd da Casa (seleção que vai apostar)</label>
            <input type="text" id="oddCasa" class="input-field" placeholder="Ex: 1.82" />
        </div>

        <button class="calculate-btn" onclick="calcularStakeLOGKelly()">
            Calcular Stake (LOG + Kelly)
        </button>
        
        <div id="resultado" class="result-container">
            <div class="result-text" id="resultText"></div>
        </div>
        
        <p class="info-text">
            Digite as odds usando ponto ou vírgula como separador decimal
        </p>
    </div>

    <script>
        // === FUNÇÃO LOG (Power Method simplificado para 2 seleções) ===
        function calcularOddJustaLOG(odd1, odd2) {
            const probsImplicitas = [1/odd1, 1/odd2];
            const somaProbs = probsImplicitas[0] + probsImplicitas[1];

            function ajustar(alpha) {
                const ajustadas = probsImplicitas.map(p => Math.pow(p, alpha));
                const soma = ajustadas.reduce((a,b) => a+b, 0);
                return ajustadas.map(p => p/soma);
            }

            // busca binária para encontrar alpha
            let low = 0.01, high = 5, alpha = 1;
            for (let i=0; i<50; i++) {
                alpha = (low+high)/2;
                const somaTest = ajustar(alpha).reduce((a,b) => a+b, 0);
                if (somaTest > somaProbs/100) {
                    high = alpha;
                } else {
                    low = alpha;
                }
            }

            return ajustar(alpha).map(p => 1/p); // odds justas
        }

        // === CALCULO FINAL (LOG + KELLY 12.5%) ===
        function calcularStakeLOGKelly() {
            try {
                const odd1 = parseFloat(document.getElementById('odd1').value.replace(',', '.'));
                const odd2 = parseFloat(document.getElementById('odd2').value.replace(',', '.'));
                const oddCasa = parseFloat(document.getElementById('oddCasa').value.replace(',', '.'));

                if ([odd1, odd2, oddCasa].some(o => isNaN(o) || o <= 1)) {
                    throw new Error('Insira odds válidas (>1).');
                }

                // calcular odds justas via LOG
                const oddsJustas = calcularOddJustaLOG(odd1, odd2);
                const oddJusta = oddsJustas[0]; // assume aposta na primeira odd

                // cálculo Kelly
                const p = 1 / oddJusta;
                const q = 1 - p;
                const b = oddCasa - 1;
                let kelly = ((b * p - q) / b) * 0.125;
                kelly = Math.max(0, kelly);

                let kellyPercent = kelly * 100;
                const stakeArredondada = Math.round(kellyPercent * 4) / 4;

                mostrarResultado(`Odd Justa (LOG): ${oddJusta.toFixed(3)} | Stake ideal: ${stakeArredondada.toFixed(2)}%`, false);

            } catch (error) {
                mostrarResultado(`Erro: ${error.message}`, true);
            }
        }

        function mostrarResultado(texto, isError) {
            const resultContainer = document.getElementById('resultado');
            const resultText = document.getElementById('resultText');
            resultContainer.classList.remove('show', 'error-message');
            if (isError) {
                resultContainer.classList.add('error-message');
            }
            resultText.textContent = texto;
            resultContainer.classList.add('show');
        }
    </script>
</body>
</html>
